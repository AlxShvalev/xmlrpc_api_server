# XML-RPC Server

## Описание
Тестовое задание на позицию Программист Python.

Сервис реализует XML-RPC сервер со следующими методами:
- авторизация пользователя по username и password;
- метод для выработки секрета по методу Диффи-Хеллмана;
- метод запроса челленджа;
- метод получения данных из БД с подписью запроса секретом.
---
## Установка
- Клонировать репозиторий
```bash
git clone https://github.com/AlxShvalev/xmlrpc_crypt.git
```
или
```bash
git clone git@github.com:AlxShvalev/xmlrpc_crypt.git
```
- перейти в папку с проектом, активировать виртуальное окружение 
и установить зависимости:
```bash
python3 -m venv venv
pip install --upgrade pip
pip install -r requirements.txt
```
- в файле settings.py указать нужные параметры сервера (IP-адрес, порт), 
а так же параметры подключения к БД PostgreSQL
- запустить проект
```bash
python main.py
```
---
## Описание клиента
Для работы с сервером используется следующий клиент:
```python
from xmlrpc.client import ServerProxy

url = f"http://{settings.SERVER_HOST}:{settings.SERVER_PORT}/RPC2"

client = ServerProxy(url)
```
---
## Описание методов сервера
### Метод аутентификации. 
Метод принимает в качестве аргументов username и password.
Если пользователь найден в БД, метод создает для него сессию и 
возвращает идентификатор сессии (строковое значение).
```python
client.auth("username", "password") 
# 867db577-33d6-49d3-8919-706873214d89
```
### Метод выработки секрета по алгоритму Диффи-Хеллмана. 
Выработка секрета происходит в два этапа. 

На первом этапе клиент отправляет запрос на сервер и получает словарь
с публичными ключами
```python
client.get_keys()

# {
#     "pub_key1": 2,
#     "pub_key2": 3,
#     "part_key": 5
# }
```
На втором этапе клиент вычисляет свою часть частичного ключа
по алгоритму Диффи-Хеллмана и отправляет его серверу. 
```python
client.generate_secret(session_id, client_part_key)
```
После чего и сервер и клиент могут вычислить общий секретный ключ.
### Метод запроса челленджа
Клиент выполняет запрос, сервер возвращает случайно сгенерированную строку 
```python
challenge = client.get_challenge(session_id)

# aSddwqertDFSfqf
```
Клиент подписывает челлендж используя в качестве ключа вычисленный 
общий с сервером секретный ключ.
```python
import hashlib, hmac

signature = hmac.new(bytes(secret_key), challenge.encrypt(), hashlib.sha256) 
```
### Метод запроса данных из БД
Клиент отправляет на сервер запрос, содержащий id сессии, ключ для выборки 
данных и подписанный челлендж.
```python
client.get_data(session_id, data_key, challenge.hexdigest())
```
Сервер проверяет подпись челленджа. В случае успеха сервер делает выборку
из БД по предоставленному ключу и возвращает данные.

Примеры запросов к серверу находятся в файле `client.py`